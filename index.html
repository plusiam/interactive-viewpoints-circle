<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸í„°ë™í‹°ë¸Œ ê´€ì ì˜ ì› - Interactive Circle of Viewpoints</title>
    <link href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #8b5cf6;
            --secondary-color: #06b6d4;
            --accent-color: #f59e0b;
            --bg-gradient-start: #f3e8ff;
            --bg-gradient-end: #dbeafe;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            font-family: 'Pretendard', sans-serif;
        }
        
        .panel {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        
        .custom-input {
            background: white;
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .custom-input:focus {
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
            outline: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .viewpoint-item {
            background: #f9fafb;
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
        }
        
        .viewpoint-item:hover {
            transform: translateX(4px);
            border-color: var(--primary-color);
        }
        
        /* ì›í˜• ë£°ë › ìŠ¤íƒ€ì¼ */
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.2);
            transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
            border: 6px solid #fff;
        }
        
        .wheel-overlay {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        
        .wheel-section {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-origin: center;
            cursor: pointer;
            pointer-events: all;
        }
        
        .section-text {
            position: absolute;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            font-size: 18px;
            pointer-events: none;
            max-width: 100px;
            text-align: center;
            word-break: keep-all;
        }
        
        .spin-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: white;
            color: var(--primary-color);
            border: 5px solid #fff;
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .spin-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-top: 30px solid var(--accent-color);
            z-index: 21;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        
        .empty-wheel {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            border: 3px dashed #d1d5db;
            color: #9ca3af;
            font-size: 18px;
            text-align: center;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .wheel-container {
                width: 320px;
                height: 320px;
            }
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-6">
    <div id="captureArea" class="max-w-7xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ¯ ì¸í„°ë™í‹°ë¸Œ ê´€ì ì˜ ì›</h1>
            <p class="text-lg text-gray-600">Interactive Circle of Viewpoints</p>
            <p class="text-sm text-gray-500 mt-1">í•˜ë²„ë“œëŒ€í•™êµ í”„ë¡œì íŠ¸ ì œë¡œ - ë³´ì´ëŠ” ì‚¬ê³ (Visible Thinking) ë£¨í‹´</p>
        </header>

        <div class="flex justify-end gap-2 mb-4">
            <button onclick="saveResult()" class="btn-secondary px-4 py-2 rounded-full font-semibold text-sm">ğŸ–¼ï¸ ê²°ê³¼ ì €ì¥</button>
            <button onclick="resetAll()" class="btn-secondary px-4 py-2 rounded-full font-semibold text-sm">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
        </div>

        <div class="grid lg:grid-cols-5 gap-6">
            <div class="lg:col-span-2 panel p-6 space-y-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ“</span>í•™ìŠµ ì •ë³´ ì„¤ì •
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">í•™ë°˜</label>
                            <input type="text" id="studentClass" class="custom-input w-full px-4 py-2 rounded-lg" placeholder="ì˜ˆ: 6í•™ë…„ 1ë°˜">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                            <input type="text" id="studentName" class="custom-input w-full px-4 py-2 rounded-lg" placeholder="í™ê¸¸ë™">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì¤‘ì‹¬ ì£¼ì œ</label>
                            <input type="text" id="mainTopic" class="custom-input w-full px-4 py-2 rounded-lg" placeholder="ì˜ˆ: ì§€êµ¬ ì˜¨ë‚œí™”">
                        </div>
                    </div>
                </div>
                
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ¡</span>ê´€ì  ì¶”ê°€
                    </h2>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="viewpointInput" class="custom-input flex-1 px-4 py-2 rounded-lg" placeholder="ê´€ì  ì…ë ¥ (ì˜ˆ: ê³¼í•™ì, ì§€êµ¬)">
                        <button onclick="addViewpoint()" class="btn-primary px-6 py-2 rounded-lg font-medium">ì¶”ê°€</button>
                    </div>
                    <div id="viewpointList" class="space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                    <p class="text-sm text-gray-500 mt-2">ğŸ’¡ ìµœëŒ€ 12ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
                    <button onclick="showExplorationPanel()" class="btn-secondary w-full py-2 rounded-lg font-medium mt-4">
                        âœï¸ íƒêµ¬ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>

            <div class="lg:col-span-3 panel p-6 flex flex-col items-center justify-center">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <div id="wheel" class="wheel empty-wheel">ê´€ì ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                    <button id="spinButton" class="spin-button" onclick="spinWheel()" style="display: none;">SPIN</button>
                </div>
                <p class="text-center mt-4 text-gray-600 text-sm">
                    ğŸ¡ SPIN ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ ì›í•˜ëŠ” ê´€ì ì„ ì§ì ‘ í´ë¦­í•˜ì„¸ìš”!<br>
                    <span class="text-gray-500">ë˜ëŠ” ì™¼ìª½ 'íƒêµ¬ ì‹œì‘í•˜ê¸°' ë²„íŠ¼ìœ¼ë¡œ ì›í•˜ëŠ” ê´€ì ì„ ì§ì ‘ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                </p>
            </div>
        </div>

        <div id="explorationPanel" class="mt-6 panel p-6 hidden"></div>
        
        <div id="savedExplorations" class="mt-6 panel p-6 hidden">
            <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ“Š íƒêµ¬ ê¸°ë¡</h3>
            <div id="explorationList" class="space-y-4"></div>
        </div>
    </div>

    <script>
        let viewpoints = [];
        let currentViewpointIndex = null;
        let isSpinning = false;
        let savedExplorations = [];
        
        const colors = [
            '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899',
            '#6366f1', '#14b8a6', '#84cc16', '#f97316', '#a855f7', '#0ea5e9'
        ];
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('viewpointInput').addEventListener('keypress', e => {
                if (e.key === 'Enter') addViewpoint();
            });
            loadData();
            
            // ìë™ ì €ì¥
            ['studentClass', 'studentName', 'mainTopic'].forEach(id => {
                document.getElementById(id).addEventListener('input', saveData);
            });
        });

        // ê´€ì  ì¶”ê°€
        function addViewpoint() {
            const input = document.getElementById('viewpointInput');
            const name = input.value.trim();
            
            if (name && viewpoints.length < 12) {
                if (viewpoints.some(vp => vp.name === name)) {
                    alert('ì´ë¯¸ ì¶”ê°€ëœ ê´€ì ì…ë‹ˆë‹¤.');
                    return;
                }
                
                viewpoints.push({
                    name,
                    color: colors[viewpoints.length % colors.length]
                });
                
                input.value = '';
                updateUI();
            } else if (viewpoints.length >= 12) {
                alert('ìµœëŒ€ 12ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê´€ì  ì œê±°
        function removeViewpoint(index) {
            viewpoints.splice(index, 1);
            // ìƒ‰ìƒ ì¬ë°°ì •
            viewpoints.forEach((vp, i) => {
                vp.color = colors[i % colors.length];
            });
            updateUI();
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            updateViewpointList();
            updateWheel();
            updateExplorationList();
            saveData();
        }

        // ê´€ì  ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateViewpointList() {
            const list = document.getElementById('viewpointList');
            list.innerHTML = viewpoints.map((vp, index) => `
                <div class="viewpoint-item flex justify-between items-center p-2 rounded-lg">
                    <div class="flex items-center gap-3">
                        <div class="w-5 h-5 rounded-full" style="background-color: ${vp.color};"></div>
                        <span class="font-medium text-gray-700">${vp.name}</span>
                    </div>
                    <button onclick="removeViewpoint(${index})" class="text-gray-400 hover:text-red-500 font-bold text-lg px-2">Ã—</button>
                </div>
            `).join('');
        }

        // ì›í˜• ë£°ë › ì—…ë°ì´íŠ¸
        function updateWheel() {
            const wheel = document.getElementById('wheel');
            const spinButton = document.getElementById('spinButton');
            
            if (viewpoints.length === 0) {
                wheel.className = 'wheel empty-wheel';
                wheel.style.background = '';
                wheel.innerHTML = 'ê´€ì ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”';
                spinButton.style.display = 'none';
                return;
            }
            
            wheel.className = 'wheel';
            spinButton.style.display = 'flex';
            
            // conic-gradientë¡œ ì› ê·¸ë¦¬ê¸°
            const anglePerSection = 360 / viewpoints.length;
            const gradientStops = [];
            
            viewpoints.forEach((vp, i) => {
                const startAngle = i * anglePerSection;
                const endAngle = (i + 1) * anglePerSection;
                gradientStops.push(`${vp.color} ${startAngle}deg ${endAngle}deg`);
            });
            
            wheel.style.background = `conic-gradient(from -90deg, ${gradientStops.join(', ')})`;
            
            // í…ìŠ¤íŠ¸ì™€ í´ë¦­ ì˜ì—­ ì¶”ê°€
            wheel.innerHTML = '';
            viewpoints.forEach((vp, index) => {
                // í´ë¦­ ê°€ëŠ¥í•œ ì˜ì—­
                const section = document.createElement('div');
                section.className = 'wheel-section';
                section.style.transform = `rotate(${anglePerSection * index}deg)`;
                section.style.clipPath = `polygon(50% 50%, 50% 0, ${50 + 50 * Math.tan(anglePerSection * Math.PI / 180)}% 0)`;
                section.onclick = () => selectViewpoint(index);
                
                // í…ìŠ¤íŠ¸
                const textContainer = document.createElement('div');
                textContainer.style.position = 'absolute';
                textContainer.style.width = '100%';
                textContainer.style.height = '100%';
                
                const text = document.createElement('div');
                text.className = 'section-text';
                const textAngle = anglePerSection * index + anglePerSection / 2 - 90;
                const radius = 120;
                const x = 50 + radius * Math.cos(textAngle * Math.PI / 180) / 2;
                const y = 50 + radius * Math.sin(textAngle * Math.PI / 180) / 2;
                text.style.left = `${x}%`;
                text.style.top = `${y}%`;
                text.style.transform = 'translate(-50%, -50%)';
                text.textContent = vp.name;
                
                textContainer.appendChild(text);
                wheel.appendChild(section);
                wheel.appendChild(textContainer);
            });
        }
        
        // ê´€ì  ì„ íƒ
        function selectViewpoint(index) {
            if (isSpinning) return;
            currentViewpointIndex = index;
            const viewpoint = viewpoints[index];
            showExplorationPanel(viewpoint.name);
        }
        
        // íƒêµ¬ íŒ¨ë„ í‘œì‹œ
        function showExplorationPanel(viewpointName = '') {
            const panel = document.getElementById('explorationPanel');
            panel.classList.remove('hidden');
            
            // ê¸°ì¡´ ì €ì¥ëœ ë‚´ìš© ì°¾ê¸°
            const existing = savedExplorations.find(e => e.viewpoint.name === viewpointName) || {};
            
            panel.innerHTML = `
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <span class="text-2xl mr-2">ğŸ§ </span>ê´€ì  íƒêµ¬í•˜ê¸°
                </h2>
                <div class="mb-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                    <label class="block text-sm font-medium text-gray-700 mb-2">íƒêµ¬í•  ê´€ì ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•˜ì„¸ìš”:</label>
                    <div class="flex gap-2">
                        <select id="viewpointSelect" class="custom-input flex-1 px-4 py-2 rounded-lg" onchange="updateSelectedViewpoint()">
                            <option value="">ì§ì ‘ ì…ë ¥...</option>
                            ${viewpoints.map(vp => 
                                `<option value="${vp.name}" ${vp.name === viewpointName ? 'selected' : ''}>${vp.name}</option>`
                            ).join('')}
                        </select>
                        <input type="text" id="customViewpoint" class="custom-input flex-1 px-4 py-2 rounded-lg" 
                               placeholder="ìƒˆë¡œìš´ ê´€ì  ì…ë ¥" value="${viewpointName}" onkeyup="updateViewpointDisplay()">
                    </div>
                </div>
                
                <div id="explorationContent" class="space-y-4">
                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-bold text-gray-600 mb-2">
                            <span id="currentViewpointDisplay" class="text-purple-700">${viewpointName || 'ê´€ì ì„ ì„ íƒí•˜ì„¸ìš”'}</span>ì˜ ì…ì¥ì—ì„œ
                        </h3>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">1ï¸âƒ£ ë‚˜ëŠ” ~ë¼ê³  ìƒê°í•œë‹¤.</label>
                        <textarea id="thinkText" rows="4" class="custom-input w-full p-3 rounded-lg resize-none" 
                                  placeholder="ì´ ê´€ì ì—ì„œ ì£¼ì œì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ”ì§€ ì‘ì„±í•˜ì„¸ìš”...">${existing.think || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">2ï¸âƒ£ ì™œëƒí•˜ë©´ ~ì´ê¸° ë•Œë¬¸ì´ë‹¤.</label>
                        <textarea id="becauseText" rows="4" class="custom-input w-full p-3 rounded-lg resize-none" 
                                  placeholder="ê·¸ë ‡ê²Œ ìƒê°í•˜ëŠ” ì´ìœ ë¥¼ ì‘ì„±í•˜ì„¸ìš”...">${existing.because || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">3ï¸âƒ£ ë‚˜ëŠ” ~ì´ ê¶ê¸ˆí•˜ë‹¤.</label>
                        <textarea id="wonderText" rows="3" class="custom-input w-full p-3 rounded-lg resize-none" 
                                  placeholder="ì´ ê´€ì ì—ì„œ ê¶ê¸ˆí•œ ì ì´ë‚˜ ì§ˆë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”...">${existing.wonder || ''}</textarea>
                    </div>
                </div>
                <button onclick="saveExploration()" class="btn-primary w-full py-3 rounded-lg font-medium mt-6">ğŸ’¾ íƒêµ¬ ë‚´ìš© ì €ì¥</button>
            `;
            
            panel.scrollIntoView({ behavior: 'smooth', block: 'center' });
            updateViewpointDisplay();
        }
        
        // ì„ íƒëœ ê´€ì  ì—…ë°ì´íŠ¸
        function updateSelectedViewpoint() {
            const select = document.getElementById('viewpointSelect');
            const customInput = document.getElementById('customViewpoint');
            if (select.value === '') {
                customInput.value = '';
                customInput.focus();
            } else {
                customInput.value = select.value;
            }
            updateViewpointDisplay();
        }
        
        // ê´€ì  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateViewpointDisplay() {
            const customInput = document.getElementById('customViewpoint');
            const display = document.getElementById('currentViewpointDisplay');
            const currentViewpoint = customInput.value.trim();
            display.textContent = currentViewpoint || 'ê´€ì ì„ ì„ íƒí•˜ì„¸ìš”';
        }

        // ë£°ë › íšŒì „
        function spinWheel() {
            if (isSpinning || viewpoints.length < 1) return;
            isSpinning = true;
            
            const wheel = document.getElementById('wheel');
            const anglePerSection = 360 / viewpoints.length;
            
            // í˜„ì¬ íšŒì „ ê°ë„ ê°€ì ¸ì˜¤ê¸°
            const currentRotation = getCurrentRotation(wheel);
            
            // ë¬´ì‘ìœ„ ì„ íƒ
            const randomIndex = Math.floor(Math.random() * viewpoints.length);
            const targetAngle = anglePerSection * randomIndex + anglePerSection / 2;
            
            // ì—¬ëŸ¬ ë°”í€´ íšŒì „ ì¶”ê°€
            const extraRotations = 5 + Math.floor(Math.random() * 3);
            const finalRotation = currentRotation + extraRotations * 360 + (360 - targetAngle);
            
            wheel.style.transform = `rotate(${finalRotation}deg)`;
            
            setTimeout(() => {
                isSpinning = false;
                selectViewpoint(randomIndex);
            }, 5000);
        }
        
        // í˜„ì¬ íšŒì „ ê°ë„ ê°€ì ¸ì˜¤ê¸°
        function getCurrentRotation(element) {
            const transform = window.getComputedStyle(element).transform;
            if (transform === 'none') return 0;
            
            const values = transform.match(/matrix\((.+)\)/)[1].split(', ');
            const a = values[0];
            const b = values[1];
            let angle = Math.atan2(b, a) * (180 / Math.PI);
            
            return angle < 0 ? angle + 360 : angle;
        }

        // íƒêµ¬ ë‚´ìš© ì €ì¥
        function saveExploration() {
            const customViewpoint = document.getElementById('customViewpoint').value.trim();
            
            if (!customViewpoint) {
                alert('íƒêµ¬í•  ê´€ì ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const think = document.getElementById('thinkText').value.trim();
            const because = document.getElementById('becauseText').value.trim();
            const wonder = document.getElementById('wonderText').value.trim();
            
            if (!think && !because && !wonder) {
                alert('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ íƒêµ¬ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì„ íƒëœ ê´€ì ì˜ ìƒ‰ìƒ ì°¾ê¸°
            const existingViewpoint = viewpoints.find(vp => vp.name === customViewpoint);
            const viewpointColor = existingViewpoint ? existingViewpoint.color : '#9ca3af';
            
            const exploration = {
                viewpoint: {
                    name: customViewpoint,
                    color: viewpointColor
                },
                think,
                because,
                wonder,
                timestamp: new Date().toLocaleString('ko-KR')
            };
            
            // ê°™ì€ ê´€ì ì˜ ê¸°ì¡´ íƒêµ¬ ì—…ë°ì´íŠ¸ ë˜ëŠ” ì¶”ê°€
            const existingIndex = savedExplorations.findIndex(exp => 
                exp.viewpoint.name === exploration.viewpoint.name
            );
            
            if (existingIndex !== -1) {
                savedExplorations[existingIndex] = exploration;
            } else {
                savedExplorations.push(exploration);
            }
            
            updateExplorationList();
            saveData();
            
            // íŒ¨ë„ ìˆ¨ê¸°ê¸°
            document.getElementById('explorationPanel').classList.add('hidden');
            alert('íƒêµ¬ ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // íƒêµ¬ ê¸°ë¡ ì—…ë°ì´íŠ¸
        function updateExplorationList() {
            const container = document.getElementById('savedExplorations');
            const list = document.getElementById('explorationList');
            
            if (savedExplorations.length === 0) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            
            list.innerHTML = savedExplorations.map((exp, index) => `
                <div class="p-4 rounded-lg border bg-white" style="border-left: 5px solid ${exp.viewpoint.color};">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-lg" style="color: ${exp.viewpoint.color};">${exp.viewpoint.name}ì˜ ê´€ì </h4>
                        <button onclick="removeExploration(${index})" class="text-gray-400 hover:text-red-500 text-lg font-bold">Ã—</button>
                    </div>
                    ${exp.think ? `<p class="text-sm text-gray-700 mb-2"><strong class="text-purple-600">ìƒê°:</strong> ${exp.think}</p>` : ''}
                    ${exp.because ? `<p class="text-sm text-gray-700 mb-2"><strong class="text-orange-600">ì´ìœ :</strong> ${exp.because}</p>` : ''}
                    ${exp.wonder ? `<p class="text-sm text-gray-700"><strong class="text-cyan-600">ê¶ê¸ˆí•œ ì :</strong> ${exp.wonder}</p>` : ''}
                    <p class="text-xs text-gray-500 mt-2">${exp.timestamp}</p>
                </div>
            `).join('');
        }
        
        // íƒêµ¬ ê¸°ë¡ ì‚­ì œ
        function removeExploration(index) {
            savedExplorations.splice(index, 1);
            updateUI();
        }
        
        // ê²°ê³¼ ì €ì¥
        async function saveResult() {
            const studentClass = document.getElementById('studentClass').value.trim();
            const studentName = document.getElementById('studentName').value.trim();
            const mainTopic = document.getElementById('mainTopic').value.trim();
            
            if (!studentClass || !studentName || !mainTopic) {
                alert('í•™ìŠµ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (viewpoints.length === 0) {
                alert('ê´€ì ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.style.display = 'none');
            
            try {
                const canvas = await html2canvas(document.getElementById('captureArea'), {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: null,
                    logging: false
                });
                
                const link = document.createElement('a');
                const date = new Date().toLocaleDateString('ko-KR').replace(/\./g, '');
                link.download = `ê´€ì ì˜ì›_${studentClass}_${studentName}_${date}.png`;
                link.href = canvas.toDataURL();
                link.click();
            } finally {
                // ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
                buttons.forEach(btn => btn.style.display = '');
            }
        }

        // ì „ì²´ ì´ˆê¸°í™”
        function resetAll() {
            if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥ë˜ì§€ ì•Šì€ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                // ë°ì´í„° ì´ˆê¸°í™”
                viewpoints = [];
                savedExplorations = [];
                currentViewpointIndex = null;
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                ['studentClass', 'studentName', 'mainTopic', 'viewpointInput'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                
                // UI ì´ˆê¸°í™”
                document.getElementById('explorationPanel').classList.add('hidden');
                updateUI();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”
                localStorage.removeItem('circleOfViewpoints');
            }
        }
        
        // ë°ì´í„° ì €ì¥
        function saveData() {
            const data = {
                studentClass: document.getElementById('studentClass').value,
                studentName: document.getElementById('studentName').value,
                mainTopic: document.getElementById('mainTopic').value,
                viewpoints,
                savedExplorations
            };
            localStorage.setItem('circleOfViewpoints', JSON.stringify(data));
        }

        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadData() {
            const saved = localStorage.getItem('circleOfViewpoints');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    document.getElementById('studentClass').value = data.studentClass || '';
                    document.getElementById('studentName').value = data.studentName || '';
                    document.getElementById('mainTopic').value = data.mainTopic || '';
                    viewpoints = data.viewpoints || [];
                    savedExplorations = data.savedExplorations || [];
                    updateUI();
                } catch (e) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
        }
    </script>
</body>
</html>